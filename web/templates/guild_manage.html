{% extends "base.html" %}
{% block title %}길드 추가/관리{% endblock %}
{% block crumb %}길드 관리{% endblock %}
{% block heading %}길드 추가/관리{% endblock %}
{% block actions %}
<span class="badge neutral">총 {{ total }}개</span>
{% endblock %}
{% block content %}
<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">수동 등록</p>
            <h2>서버 ID로 길드 추가</h2>
        </div>
    </header>
    <form method="post" action="/guilds/add" class="form-inline">
        <input type="number" name="guild_id" placeholder="서버 ID 입력" required>
        <button type="submit" class="btn-primary">추가</button>
    </form>
    <p class="muted" style="margin: 6px 0 0;">봇이 이미 참여한 서버 ID를 입력하면 기본 설정이 생성되고 상세 페이지로 이동합니다.</p>
</section>

<section class="panel">
    <header class="panel__header">
        <div>
            <p class="eyebrow">등록 현황</p>
            <h2>등록된 길드</h2>
        </div>
        <span class="badge neutral">{{ total }}개</span>
    </header>
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
            <tr>
                <th>길드 ID</th>
                <th>이름</th>
                <th>스팸 한도/시간</th>
                <th>링크 차단</th>
                <th>멘션 한도</th>
                <th>AI 예외 키워드</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for cfg in configs %}
            <tr>
                <td>{{ cfg.guild_id }}</td>
                <td>{{ names.get(cfg.guild_id, 'Unknown') }}</td>
                <td>{{ cfg.spam_limit }}회 / {{ cfg.time_window }}초</td>
                <td>{{ "ON" if cfg.link_block else "OFF" }}</td>
                <td>{{ cfg.mention_limit }}</td>
                <td>{{ cfg.exception_keywords|length }}</td>
                <td class="align-right" style="display:flex; gap:6px; justify-content:flex-end;">
                    <a class="btn-ghost" href="/?guild_id={{ cfg.guild_id }}">열기</a>
                    <form method="post" action="/guilds/delete" onsubmit="return confirm('삭제하시겠습니까?');">
                        <input type="hidden" name="guild_id" value="{{ cfg.guild_id }}">
                        <button class="btn-ghost danger" type="submit">삭제</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="empty-state">등록된 길드가 없습니다.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
